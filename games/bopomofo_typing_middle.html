<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³¨éŸ³æ‰“å­— - ä¸­å€ - ä¿¡å…ƒè€å¸«é›»è…¦æ•™å­¸ç¶²</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans TC', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            user-select: none;
        }

        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .game-header {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .game-info {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 25px;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            gap: 30px;
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        .game-controls {
            display: flex;
            gap: 15px;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .main-display {
            text-align: center;
            margin-bottom: 80px;
        }

        .current-symbol {
            font-size: 150px;
            font-weight: bold;
            color: white;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
            min-height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .symbol-hint {
            font-size: 1.2em;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 10px;
        }

        .keyboard-container {
            background: #0b1220;
            padding: 20px;
            border-radius: 10px;
            position: relative;
        }

        .keyboard-row {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            align-items: center;
            justify-content: flex-start;
            width: 100%;
        }

        .keyboard-key {
            width: 56px;
            height: 48px;
            background: #e6eef8;
            color: #081226;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            box-shadow: inset 0 -3px 0 rgba(0,0,0,0.08), 0 6px 18px rgba(2,6,23,0.5);
            user-select: none;
            transition: all 0.2s ease;
            font-size: 1.4em;
            cursor: default;
        }

        .keyboard-key.small {
            width: 42px;
            height: 40px;
            font-size: 13px;
        }
        
        .keyboard-key.small-wide {
            width: calc(42px * 1.2);
            height: 40px;
            font-size: 13px;
        }
        
        .keyboard-key.small-wider {
            width: calc(42px * 1.2);
            height: 40px;
            font-size: 13px;
        }
        
        .keyboard-key.right-align {
            margin-left: auto;
        }
        
        .keyboard-row .left-section {
            display: flex;
            gap: 8px;
            align-items: center;
            flex: 1;
        }
        
        .keyboard-row .right-section {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .keyboard-key.wide {
            width: calc(56px * 1.75 + 8px);
        }

        .keyboard-key.tab {
            width: calc(56px * 1.4 + 8px);
        }

        .keyboard-key.caps {
            width: calc(56px * 1.6 + 8px);
        }

        .keyboard-key.shift {
            width: calc(56px * 2.2 + 8px);
        }

        .keyboard-key.enter {
            width: calc(56px * 1.6 + 8px);
        }
        
        .keyboard-key.enter-11 {
            width: calc((56px * 1.6 + 8px) * 1.1);
        }
        
        .keyboard-key.wide-12 {
            width: calc((56px * 1.75 + 8px) * 1.2 * 1.1);
        }

        .keyboard-key.back {
            width: calc(56px * 1.4 + 8px);
        }

        .keyboard-key.space {
            flex: 1;
            height: 48px;
            border-radius: 8px;
            background: #cbd5e1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #071226;
            font-weight: 700;
        }
        
        .keyboard-key.blank-key {
            background: #cbd5e1;
            color: #071226;
            cursor: default;
            opacity: 0.8;
        }

        .keyboard-key.blank-key:not(.tab):not(.caps):not(.shift):not(.enter):not(.back):not(.space) {
            background: #e6eef8;
            opacity: 0.6;
        }

        .keyboard-key.highlight {
            background: #ffd700;
            border-color: #ffb700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            animation: pulse 1s infinite;
        }

        .keyboard-key.correct {
            background: #4caf50;
            border-color: #45a049;
            color: white;
            animation: correctPulse 0.5s ease-out;
        }

        .keyboard-key.wrong {
            background: #f44336;
            border-color: #d32f2f;
            color: white;
            animation: wrongShake 0.5s ease-out;
        }

        .keyboard-key.hidden {
            display: none;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 200;
            display: none;
        }

        .game-over h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .final-score {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 20px;
        }

        .game-stats {
            background: rgba(102, 126, 234, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #666;
            font-weight: bold;
        }

        .stat-value {
            color: #333;
            font-weight: bold;
        }

        .game-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .game-actions .btn {
            min-width: 120px;
        }

        .history-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid #dee2e6;
        }

        .history-section h3 {
            color: #3A7CA5;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .history-stats {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-label {
            color: #666;
            font-weight: bold;
        }

        .history-value {
            color: #3A7CA5;
            font-weight: bold;
            font-size: 1.1em;
        }

        .view-leaderboard-btn {
            background: linear-gradient(45deg, #ff9800, #f57c00);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 24px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
            width: 100%;
        }

        .view-leaderboard-btn:hover {
            background: linear-gradient(45deg, #f57c00, #ef6c00);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
        }

        .game-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 24px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .game-btn:hover {
            background: linear-gradient(45deg, #45a049, #388E3C);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        .game-btn#backToListBtn {
            background: linear-gradient(45deg, #9e9e9e, #757575);
        }

        .game-btn#backToListBtn:hover {
            background: linear-gradient(45deg, #757575, #616161);
        }

        .back-btn {
            position: fixed;
            top: 120px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            text-decoration: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .back-btn:hover {
            background: white;
            transform: translateY(-2px);
        }

        .instructions-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .instructions-content {
            background: #fff;
            padding: 30px;
            border-radius: 15px;
            text-align: left;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .instructions-content h2 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .instructions-text {
            color: #555;
            font-size: 1em;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .instructions-text p {
            margin-bottom: 10px;
        }

        .instructions-text strong {
            color: #333;
        }

        .instructions-text ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }

        .instructions-text li {
            margin-bottom: 5px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <a href="#" class="back-btn" onclick="handleBackClick(event)">è¿”å›</a>

    <div class="game-container">
        <!-- éŠæˆ²èªªæ˜å½ˆçª— -->
        <div id="gameInstructions" class="instructions-overlay">
            <div class="instructions-content">
                <h2>æ³¨éŸ³æ‰“å­— - ä¸­å€</h2>
                <div class="instructions-text">
                    <p>ğŸ¯ <strong>éŠæˆ²ç›®æ¨™ï¼š</strong>æ ¹æ“šè¢å¹•ä¸Šé¡¯ç¤ºçš„æ³¨éŸ³ç¬¦è™Ÿï¼ŒæŒ‰éµç›¤ä¸Šå°æ‡‰ä½ç½®çš„æŒ‰éµ</p>
                    <p>âŒ¨ï¸ <strong>æ“ä½œæ–¹å¼ï¼š</strong>æ ¹æ“šç•«é¢ä¸Šçš„é¡Œç›®æŒ‰ä¸‹å°æ‡‰çš„æŒ‰éµï¼Œå‰30é¡Œæœƒæœ‰æç¤ºï¼Œè¶…é30é¡Œå¾Œæ²’æœ‰æç¤º</p>
                    <p>â±ï¸ <strong>æ™‚é–“é™åˆ¶ï¼š</strong>2åˆ†é˜å…§ç­”å°è¶Šå¤šé¡Œç›®ï¼Œåˆ†æ•¸è¶Šé«˜</p>
                    <p>ğŸ“ <strong>ç·´ç¿’ç¯„åœï¼š</strong>åƒ…é™éµç›¤ä¸­å€æ³¨éŸ³ç¬¦è™Ÿ (Ë‹ã„ã„‘ã„’ã„“ã„”ã„•ã„–ËŠã„—ã„˜ã„™Ë™ã„§ã„¨ã„©)</p>
                    <p>ğŸ¹ <strong>éµç›¤é¡¯ç¤ºï¼š</strong>éµç›¤ä¸Šåªé¡¯ç¤ºç·´ç¿’ç¯„åœå…§çš„æ³¨éŸ³ç¬¦è™Ÿï¼Œå…¶ä»–éµä½ä¿ç•™ä½†ä¸é¡¯ç¤ºæ³¨éŸ³</p>
                </div>
                <button class="btn btn-primary" onclick="startGameWithInstructions()">æˆ‘çŸ¥é“äº†ï¼Œé–‹å§‹éŠæˆ²ï¼</button>
            </div>
        </div>

        <div class="game-header">
            <div class="game-info">
                <div class="info-item">
                    <div class="info-label">åˆ†æ•¸</div>
                    <div class="info-value" id="score">0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">æ­£ç¢º</div>
                    <div class="info-value" id="correct">0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">éŒ¯èª¤</div>
                    <div class="info-value" id="wrong">0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">é€£çºŒç­”å°</div>
                    <div class="info-value" id="consecutiveCorrect">0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">æ™‚é–“</div>
                    <div class="info-value" id="timeLeft">120</div>
                </div>
            </div>
            <div class="game-controls">
                <button class="btn" id="pauseBtn" onclick="togglePause()" disabled>æš«åœ</button>
            </div>
        </div>

        <div class="main-display">
            <div class="current-symbol" id="currentSymbol">ã„…</div>
            <div class="symbol-hint" id="symbolHint">ç·´ç¿’ä¸­å€æ³¨éŸ³ç¬¦è™Ÿ - æŒ‰éµç›¤ä¸Šå°æ‡‰ä½ç½®çš„æŒ‰éµ</div>
        </div>

        <div class="keyboard-container">
            <!-- ç¬¬ä¸€æ’ï¼šæ•¸å­—åˆ—ï¼ˆä¿ç•™ ` å’Œ 1~0 - = Backspaceï¼‰ -->
            <div class="keyboard-row">
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key" data-symbol="Ë‹">Ë‹</div>
                <div class="keyboard-key" data-symbol="ã„“">ã„“</div>
                <div class="keyboard-key" data-symbol="ËŠ">ËŠ</div>
                <div class="keyboard-key" data-symbol="Ë™">Ë™</div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key back right-align"></div>
            </div>

            <!-- ç¬¬äºŒæ’ï¼šTab q-p [ ] \ -->
            <div class="keyboard-row">
                <div class="keyboard-key blank-key tab"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key" data-symbol="ã„">ã„</div>
                <div class="keyboard-key" data-symbol="ã„”">ã„”</div>
                <div class="keyboard-key" data-symbol="ã„—">ã„—</div>
                <div class="keyboard-key" data-symbol="ã„§">ã„§</div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key right-align"></div>
            </div>

            <!-- ç¬¬ä¸‰æ’ï¼šCaps A-L ; ' Enter -->
            <div class="keyboard-row">
                <div class="keyboard-key blank-key caps"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key" data-symbol="ã„‘">ã„‘</div>
                <div class="keyboard-key" data-symbol="ã„•">ã„•</div>
                <div class="keyboard-key" data-symbol="ã„˜">ã„˜</div>
                <div class="keyboard-key" data-symbol="ã„¨">ã„¨</div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key enter-11"></div>
            </div>

            <!-- ç¬¬å››æ’ï¼šShift Z-M , . / Shift -->
            <div class="keyboard-row">
                <div class="keyboard-key blank-key shift"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key" data-symbol="ã„’">ã„’</div>
                <div class="keyboard-key" data-symbol="ã„–">ã„–</div>
                <div class="keyboard-key" data-symbol="ã„™">ã„™</div>
                <div class="keyboard-key" data-symbol="ã„©">ã„©</div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key"></div>
                <div class="keyboard-key blank-key wide-12"></div>
            </div>

            <!-- ç¬¬äº”æ’ï¼šCtrl Win Alt (space) å››å€‹ç©ºç™½éµä½ -->
            <div class="keyboard-row">
                <div class="keyboard-key blank-key small-wide"></div>
                <div class="keyboard-key blank-key small-wide"></div>
                <div class="keyboard-key blank-key small-wide"></div>
                <div class="keyboard-key space" style="width: calc(56px * 1.5);"></div>
                <div class="keyboard-key blank-key small-wider"></div>
                <div class="keyboard-key blank-key small-wider"></div>
                <div class="keyboard-key blank-key small-wider"></div>
                <div class="keyboard-key blank-key small-wider right-align"></div>
            </div>
        </div>
    </div>

    <div class="game-over" id="gameOver">
        <h2>éŠæˆ²çµæŸï¼</h2>
        <div class="final-score" id="finalScore">0</div>
        <div class="game-stats" id="gameStats">
            <div class="stat-item">
                <span class="stat-label">ç­”å°é¡Œæ•¸ï¼š</span>
                <span class="stat-value" id="finalCorrect">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ç­”éŒ¯é¡Œæ•¸ï¼š</span>
                <span class="stat-value" id="finalWrong">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">æº–ç¢ºç‡ï¼š</span>
                <span class="stat-value" id="finalAccuracy">0%</span>
            </div>
        </div>
        
        <div class="game-actions">
            <button class="game-btn" onclick="restartGame()">å†ç©ä¸€æ¬¡</button>
            <button class="game-btn" onclick="handleBackClick(event)">è¿”å›</button>
        </div>
    </div>

    <script>
        class BopomofoTypingLeftGame {
            constructor() {
                this.currentZone = 'middle'; // å›ºå®šç‚ºä¸­å€
                this.isPlaying = false;
                this.isPaused = false;
                this.score = 0;
                this.correct = 0;
                this.wrong = 0;
                this.timeLeft = 120; // 2åˆ†é˜
                this.currentSymbol = '';
                this.gameInterval = null;
                this.timeInterval = null;
                this.consecutiveCorrect = 0; // é€£çºŒç­”å°æ¬¡æ•¸
                this.lastSymbol = ''; // ä¸Šä¸€é¡Œçš„ç¬¦è™Ÿ
                
                console.log('ä¸­å€éŠæˆ²é¡æ§‹é€ å‡½æ•¸é–‹å§‹...');
                this.initializeElements();
                this.setupEventListeners();
                this.loadZoneData();
                
                // è¨­ç½®åˆå§‹ç¬¦è™Ÿï¼ˆä¸­å€ç¬¬ä¸€å€‹ç¬¦è™Ÿï¼‰
                this.currentSymbol = 'ã„';
                this.currentSymbolElement.textContent = this.currentSymbol;
                this.lastSymbol = this.currentSymbol;
                console.log('è¨­ç½®åˆå§‹ç¬¦è™Ÿ:', this.currentSymbol);
                
                console.log('ä¸­å€éŠæˆ²é¡æ§‹é€ å‡½æ•¸å®Œæˆ');
            }

            initializeElements() {
                this.scoreElement = document.getElementById('score');
                this.correctElement = document.getElementById('correct');
                this.wrongElement = document.getElementById('wrong');
                this.consecutiveCorrectElement = document.getElementById('consecutiveCorrect');
                this.timeElement = document.getElementById('timeLeft');
                this.currentSymbolElement = document.getElementById('currentSymbol');
                this.symbolHintElement = document.getElementById('symbolHint');
                this.pauseBtn = document.getElementById('pauseBtn');
                this.gameOver = document.getElementById('gameOver');
                
                this.keyboardKeys = document.querySelectorAll('.keyboard-key');
                
                console.log('åˆå§‹åŒ–å…ƒç´ æª¢æŸ¥:');
                console.log('åˆ†æ•¸å…ƒç´ :', this.scoreElement);
                console.log('æ­£ç¢ºå…ƒç´ :', this.correctElement);
                console.log('éŒ¯èª¤å…ƒç´ :', this.wrongElement);
                console.log('é€£çºŒç­”å°å…ƒç´ :', this.consecutiveCorrectElement);
                console.log('æ™‚é–“å…ƒç´ :', this.timeElement);
                console.log('ç•¶å‰ç¬¦è™Ÿå…ƒç´ :', this.currentSymbolElement);
                console.log('ç¬¦è™Ÿæç¤ºå…ƒç´ :', this.symbolHintElement);
                console.log('æš«åœæŒ‰éˆ•:', this.pauseBtn);
                console.log('éŠæˆ²çµæŸå…ƒç´ :', this.gameOver);
                console.log('éµç›¤æŒ‰éµæ•¸é‡:', this.keyboardKeys.length);
            }

            setupEventListeners() {
                // éµç›¤äº‹ä»¶
                document.addEventListener('keydown', (e) => this.handleKeyboardInput(e));
            }

            loadZoneData() {
                // ä¸­å€æ³¨éŸ³ç¬¦è™Ÿ
                this.zoneData = {
                    middle: ['Ë‹', 'ã„', 'ã„‘', 'ã„’', 'ã„“', 'ã„”', 'ã„•', 'ã„–', 'ËŠ', 'ã„—', 'ã„˜', 'ã„™', 'Ë™', 'ã„§', 'ã„¨', 'ã„©']
                };
            }

            startGame() {
                if (this.isPlaying) return;
                
                console.log('é–‹å§‹ä¸­å€éŠæˆ²...');
                this.isPlaying = true;
                this.consecutiveCorrect = 0; // é‡ç½®é€£çºŒç­”å°è¨ˆæ•¸
                this.pauseBtn.disabled = false;
                
                // éš±è—éŠæˆ²èªªæ˜å½ˆçª—
                const instructionsElement = document.getElementById('gameInstructions');
                if (instructionsElement) {
                    instructionsElement.style.display = 'none';
                    console.log('éŠæˆ²èªªæ˜å½ˆçª—å·²éš±è—');
                }
                
                this.generateNewSymbol();
                this.startTimer();
                console.log('ä¸­å€éŠæˆ²å·²é–‹å§‹ï¼Œç•¶å‰ç¬¦è™Ÿ:', this.currentSymbol);
            }

            generateNewSymbol() {
                const symbols = this.zoneData[this.currentZone];
                let newSymbol;
                let attempts = 0;
                const maxAttempts = 10; // é˜²æ­¢ç„¡é™å¾ªç’°
                
                do {
                    newSymbol = symbols[Math.floor(Math.random() * symbols.length)];
                    attempts++;
                    // å¦‚æœåªæœ‰ä¸€å€‹ç¬¦è™Ÿæˆ–è€…å˜—è©¦æ¬¡æ•¸éå¤šï¼Œç›´æ¥ä½¿ç”¨ç•¶å‰ç¬¦è™Ÿ
                    if (symbols.length === 1 || attempts >= maxAttempts) {
                        break;
                    }
                } while (newSymbol === this.lastSymbol);
                
                this.lastSymbol = this.currentSymbol;
                this.currentSymbol = newSymbol;
                this.currentSymbolElement.textContent = this.currentSymbol;
                
                console.log('ç”Ÿæˆæ–°ç¬¦è™Ÿ:', this.currentSymbol, 'ä¾†è‡ªå€åˆ¥:', this.currentZone);
                console.log('å¯ç”¨ç¬¦è™Ÿ:', symbols, 'ä¸Šä¸€é¡Œ:', this.lastSymbol);
                
                // é«˜äº®å°æ‡‰çš„éµç›¤æŒ‰éµï¼ˆåªæœ‰åœ¨ç­”å°æ•¸å°‘æ–¼30é¡Œæ™‚æ‰é¡¯ç¤ºï¼‰
                if (this.correct < 30) {
                    this.highlightCurrentKey();
                } else {
                    // ç­”å°æ•¸è¶…é30é¡Œï¼Œæ¸…é™¤æ‰€æœ‰é«˜äº®
                    this.keyboardKeys.forEach(key => {
                        key.classList.remove('highlight');
                    });
                    console.log('ç­”å°æ•¸è¶…é30é¡Œï¼Œå·²å–æ¶ˆéµä½äº®èµ·æç¤º');
                }
            }

            highlightCurrentKey() {
                // æ¸…é™¤æ‰€æœ‰é«˜äº®
                this.keyboardKeys.forEach(key => {
                    key.classList.remove('highlight');
                });
                
                // é«˜äº®ç•¶å‰ç¬¦è™Ÿå°æ‡‰çš„æŒ‰éµ
                const targetKey = Array.from(this.keyboardKeys).find(key => 
                    key.getAttribute('data-symbol') === this.currentSymbol
                );
                
                if (targetKey) {
                    targetKey.classList.add('highlight');
                    console.log('å·²é«˜äº®æŒ‰éµ:', targetKey, 'ç¬¦è™Ÿ:', this.currentSymbol);
                } else {
                    console.error('æ‰¾ä¸åˆ°å°æ‡‰çš„æŒ‰éµ:', this.currentSymbol);
                    console.log('æ‰€æœ‰å¯ç”¨æŒ‰éµ:', Array.from(this.keyboardKeys).map(k => k.getAttribute('data-symbol')));
                }
            }

            handleKeyboardInput(e) {
                if (!this.isPlaying || this.isPaused) return;
                
                // DEBUG: ESCéµå¿«é€Ÿè·³è½‰åˆ°éŠæˆ²çµæŸ
                if (e.key === 'Escape') {
                    console.log('DEBUG: ESCéµæŒ‰ä¸‹ï¼Œå¿«é€Ÿè·³è½‰åˆ°éŠæˆ²çµæŸ');
                    this.endGame();
                    return;
                }
                
                // æ ¹æ“šå¯¦éš›éµç›¤ä½ˆå±€å°æ‡‰æ³¨éŸ³ç¬¦è™Ÿçš„æ˜ å°„ï¼ˆåƒ…ä¸­å€ï¼‰
                const positionMap = {
                    // ç¬¬ä¸€æ’ï¼šæ•¸å­—åˆ—ï¼ˆ1-0, -, =ï¼‰
                    '4': 'Ë‹', '5': 'ã„“', '6': 'ËŠ', '7': 'Ë™',
                    
                    // ç¬¬äºŒæ’ï¼šTab q-p
                    'r': 'ã„', 't': 'ã„”', 'y': 'ã„—', 'u': 'ã„§',
                    
                    // ç¬¬ä¸‰æ’ï¼šCaps A-L
                    'f': 'ã„‘', 'g': 'ã„•', 'h': 'ã„˜', 'j': 'ã„¨',
                    
                    // ç¬¬å››æ’ï¼šShift Z-M
                    'v': 'ã„’', 'b': 'ã„–', 'n': 'ã„™', 'm': 'ã„©'
                };
                
                const pressedKey = e.key.toLowerCase();
                console.log('æŒ‰ä¸‹çš„éµ:', pressedKey, 'ç•¶å‰ç¬¦è™Ÿ:', this.currentSymbol);
                
                // è™•ç†æŒ‰éµä½ç½®å°æ‡‰
                if (positionMap[pressedKey] === this.currentSymbol) {
                    console.log('æŒ‰éµåŒ¹é…æˆåŠŸ:', pressedKey, '->', this.currentSymbol);
                    const targetKey = Array.from(this.keyboardKeys).find(key => 
                        key.getAttribute('data-symbol') === this.currentSymbol
                    );
                    if (targetKey) {
                        this.handleCorrectAnswer(targetKey);
                    }
                    return;
                }
                
                // å¦‚æœæŒ‰éŒ¯éµï¼Œé¡¯ç¤ºéŒ¯èª¤ä¸¦æ‰£åˆ†
                if (positionMap[pressedKey]) {
                    console.log('æŒ‰éŒ¯éµ:', pressedKey, '->', positionMap[pressedKey], 'æ‡‰è©²æŒ‰:', this.currentSymbol);
                    const wrongKey = Array.from(this.keyboardKeys).find(key => 
                        key.getAttribute('data-symbol') === positionMap[pressedKey]
                    );
                    if (wrongKey) {
                        this.handleWrongAnswer(wrongKey);
                    }
                } else {
                    console.log('æœªæ‰¾åˆ°åŒ¹é…çš„æŒ‰éµ:', pressedKey);
                }
            }

            handleCorrectAnswer(keyElement) {
                this.correct++;
                this.consecutiveCorrect++;
                
                // é€£çºŒç­”å°å¾—åˆ†æ©Ÿåˆ¶
                let baseScore = 10;
                if (this.consecutiveCorrect >= 3) {
                    baseScore = 15; // é€£çºŒ3é¡Œä»¥ä¸Šç­”å°ï¼Œæ¯é¡Œ15åˆ†
                }
                if (this.consecutiveCorrect >= 5) {
                    baseScore = 20; // é€£çºŒ5é¡Œä»¥ä¸Šç­”å°ï¼Œæ¯é¡Œ20åˆ†
                }
                if (this.consecutiveCorrect >= 10) {
                    baseScore = 25; // é€£çºŒ10é¡Œä»¥ä¸Šç­”å°ï¼Œæ¯é¡Œ25åˆ†
                }
                
                this.score += baseScore;
                
                keyElement.classList.remove('highlight');
                keyElement.classList.add('correct');
                
                setTimeout(() => {
                    keyElement.classList.remove('correct');
                }, 500);
                
                this.updateDisplay();
                this.generateNewSymbol();
            }

            handleWrongAnswer(keyElement) {
                this.wrong++;
                this.score = Math.max(0, this.score - 30); // ç­”éŒ¯æ‰£30åˆ†
                this.consecutiveCorrect = 0; // é‡ç½®é€£çºŒç­”å°è¨ˆæ•¸
                
                keyElement.classList.remove('highlight');
                keyElement.classList.add('wrong');
                
                setTimeout(() => {
                    keyElement.classList.remove('wrong');
                }, 500);
                
                this.updateDisplay();
            }

            startTimer() {
                this.timeInterval = setInterval(() => {
                    if (!this.isPaused) {
                        this.timeLeft--;
                        this.updateDisplay();
                        
                        if (this.timeLeft <= 0) {
                            this.endGame();
                        }
                    }
                }, 1000);
            }

            togglePause() {
                this.isPaused = !this.isPaused;
                this.pauseBtn.textContent = this.isPaused ? 'ç¹¼çºŒ' : 'æš«åœ';
            }

            endGame() {
                this.isPlaying = false;
                this.isPaused = false;
                
                clearInterval(this.timeInterval);
                
                // æ›´æ–°æœ€çµ‚çµ±è¨ˆ
                document.getElementById('finalScore').textContent = this.score;
                document.getElementById('finalCorrect').textContent = this.correct;
                document.getElementById('finalWrong').textContent = this.wrong;
                
                const accuracy = this.correct + this.wrong > 0 ? 
                    Math.round((this.correct / (this.correct + this.wrong)) * 100) : 0;
                document.getElementById('finalAccuracy').textContent = accuracy + '%';
                
                this.gameOver.style.display = 'block';
                this.pauseBtn.disabled = true;
                this.pauseBtn.textContent = 'æš«åœ';
                
                // æäº¤åˆ†æ•¸
                // Shareç‰ˆæœ¬ï¼šåˆ†æ•¸è¨ˆç®—å®Œæˆï¼Œä¸æäº¤åˆ°æ’è¡Œæ¦œ
                
                // Shareç‰ˆæœ¬ï¼šä¸è¼‰å…¥æ­·å²è¨˜éŒ„
            }

            restartGame() {
                this.gameOver.style.display = 'none';
                this.resetGame();
                this.startGame();
            }

            resetGame() {
                this.score = 0;
                this.correct = 0;
                this.wrong = 0;
                this.timeLeft = 120;
                this.isPlaying = false;
                this.isPaused = false;
                this.consecutiveCorrect = 0;
                this.lastSymbol = '';
                
                this.updateDisplay();
                this.pauseBtn.disabled = true;
                this.pauseBtn.textContent = 'æš«åœ';
                
                // æ¸…é™¤æ‰€æœ‰æŒ‰éµç‹€æ…‹
                this.keyboardKeys.forEach(key => {
                    key.classList.remove('highlight', 'correct', 'wrong');
                });
            }

            updateDisplay() {
                this.scoreElement.textContent = this.score;
                this.correctElement.textContent = this.correct;
                this.wrongElement.textContent = this.wrong;
                this.consecutiveCorrectElement.textContent = this.consecutiveCorrect;
                this.timeElement.textContent = this.timeLeft;
            }

            // Shareç‰ˆæœ¬ï¼šä¸æäº¤åˆ†æ•¸åˆ°æ’è¡Œæ¦œï¼Œåªè¨ˆç®—å’Œé¡¯ç¤ºåˆ†æ•¸
            // Shareç‰ˆæœ¬ï¼šç§»é™¤æ­·å²æœ€é«˜åˆ†è¼‰å…¥åŠŸèƒ½

            showScoreSubmitError() {
                console.log('é¡¯ç¤ºä¸­å€åˆ†æ•¸æäº¤éŒ¯èª¤ä¿¡æ¯');
                // åœ¨æ­·å²è¨˜éŒ„å€åŸŸé¡¯ç¤ºéŒ¯èª¤ä¿¡æ¯
                const historySection = document.getElementById('historySection');
                if (historySection) {
                    const errorDiv = document.createElement('div');
                    errorDiv.style.cssText = `
                        background: #ffebee;
                        border: 1px solid #f44336;
                        color: #c62828;
                        padding: 10px;
                        border-radius: 5px;
                        margin: 10px 0;
                        font-size: 0.9em;
                    `;
                    errorDiv.innerHTML = `
                        <strong>âš ï¸ åˆ†æ•¸æäº¤å¤±æ•—</strong><br>
                        åˆ†æ•¸ç„¡æ³•è‡ªå‹•ç™»å…¥åˆ°æ’è¡Œæ¦œï¼Œè«‹æª¢æŸ¥ç¶²çµ¡é€£æ¥æˆ–è¯ç¹«ç®¡ç†å“¡ã€‚
                    `;
                    
                    // æ’å…¥åˆ°æ­·å²è¨˜éŒ„å€åŸŸçš„é–‹é ­
                    historySection.insertBefore(errorDiv, historySection.firstChild);
                    
                    // 5ç§’å¾Œè‡ªå‹•ç§»é™¤éŒ¯èª¤ä¿¡æ¯
                    setTimeout(() => {
                        if (errorDiv.parentNode) {
                            errorDiv.parentNode.removeChild(errorDiv);
                        }
                    }, 5000);
                }
            }
        }

        // å…¨åŸŸå‡½æ•¸
        let game;

        function startGameWithInstructions() {
            // éš±è—èªªæ˜å½ˆçª—ä¸¦é–‹å§‹éŠæˆ²
            const instructionsElement = document.getElementById('gameInstructions');
            if (instructionsElement) {
                instructionsElement.style.display = 'none';
            }
            
            if (game) {
                game.startGame();
            }
        }

        function togglePause() {
            game.togglePause();
        }

        function restartGame() {
            game.restartGame();
        }

        function handleBackClick(event) {
            if (event) {
                event.preventDefault();
            }
            const currentPath = window.location.pathname;
            if (currentPath.includes('/PCskills/')) {
                if (window.history.length > 1) {
                    window.history.back();
                } else {
                    window.location.href = '../index.html';
                }
            } else if (currentPath.includes('/share/')) {
                window.location.href = '/share';
            } else {
                // å¦‚æœä¸æ˜¯Shareç‰ˆæœ¬ï¼Œä½¿ç”¨åŸæœ‰é‚è¼¯
                if (currentPath.includes('/teacher/')) {
                    window.location.href = '/teacher/classroom';
                } else {
                    if (window.history.length > 1) {
                        window.history.back();
                    } else {
                        window.location.href = '../index.html';
                    }
                }
            }
        }

        // Shareç‰ˆæœ¬ï¼šç§»é™¤getStudentClassIdå‡½æ•¸

        // åˆå§‹åŒ–éŠæˆ²
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOMè¼‰å…¥å®Œæˆï¼Œé–‹å§‹åˆå§‹åŒ–ä¸­å€éŠæˆ²...');
            game = new BopomofoTypingLeftGame();
            console.log('ä¸­å€éŠæˆ²å¯¦ä¾‹å‰µå»ºå®Œæˆ:', game);
            
            // ç¢ºä¿éŠæˆ²èªªæ˜å½ˆçª—åœ¨éŠæˆ²è¼‰å…¥æ™‚é¡¯ç¤º
            const instructionsElement = document.getElementById('gameInstructions');
            if (instructionsElement) {
                instructionsElement.style.display = 'flex';
                console.log('ä¸­å€éŠæˆ²èªªæ˜å½ˆçª—å·²é¡¯ç¤º');
            } else {
                console.error('æ‰¾ä¸åˆ°ä¸­å€éŠæˆ²èªªæ˜å½ˆçª—å…ƒç´ ');
            }
            
            // å„²å­˜class_id
            const urlParams = new URLSearchParams(window.location.search);
            const classId = urlParams.get('class_id');
            if (classId) {
                localStorage.setItem('student_class_id', classId);
                console.log('å·²å„²å­˜class_id:', classId);
            }
            
            // è¨­ç½®æ’è¡Œæ¦œæŒ‰éˆ•äº‹ä»¶
            // Shareç‰ˆæœ¬ï¼šç§»é™¤æ’è¡Œæ¦œæŒ‰éˆ•äº‹ä»¶ç›£è½å™¨
            
            console.log('ä¸­å€éŠæˆ²åˆå§‹åŒ–å®Œæˆ');
        });
    </script>
</body>
</html>
